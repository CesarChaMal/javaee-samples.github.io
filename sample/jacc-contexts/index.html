<!DOCTYPE html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>JavaEE Sample::::Contexts</title><link rel="stylesheet" href="http://javaee.support/stylesheets/foundation-icons.css"><link rel="stylesheet" href="http://javaee.support/stylesheets/app.css"><script src="http://javaee.support/javascripts/vendor/custom.modernizr.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="author" type="text/plain" href="http://javaee.support/humans.txt"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Contexts"></head><body class="antialiased"><nav class="top-bar"><ul class="title-area"><li class="name"><h1><a href="http://javaee.support/">JavaEE Support</a></h1></li><li class="toggle-topbar"><a href="#"><i class="fi-home"></i></a></li></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="http://javaee.support/contributors">Contributors <i class="fi-torsos-male-female"></i></a></li></li></ul></section></nav><div class="container"><header><div class="row"><div class="large-10 columns"><h2>Contexts</h2></div><div class="large-2 columns"><div class="action right"><a class="button radius round success" data-reveal-id="run">Run <i class="fi-play"></i></a><div id="run" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to run the sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jacc/contexts/">javaee7-samples</a> <i class="fi-social-github"></i> GitHub repository. The first thing we need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="highlight"><code>git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jacc/contexts/</code></pre>Now we are ready to start testing. You can run all the tests in this sample by executing:<pre class="highlight"><code>mvn test</code></pre>Or you can run individual tests by executing one of the following:<pre class="highlight"><code>mvn test -Dtest=SubjectFromPolicyContextTestmvn test -Dtest=RequestFromPolicyContextTest</code></pre></hr></div></div></div></div><div class="row"><div class="large-10 columns"><h3></h3></div></div><div class="sub"><div class="row"><div class="large-10 columns specifications"><ul class="inline-list"><li>Specifications in use:</li><li><ul class="inline-list"></ul><li><a href="http://javaee.support/#CDI" title="Context and Dependency Injection 1.1">CDI</a></li><li><a href="http://javaee.support/#EJB" title="Enterprise JavaBeans 3.2">EJB</a></li><li><a href="http://javaee.support/#JASPIC" title="Java Authentication Service Provider Interface for Containers 1.1 MR2">JASPIC</a></li><li><a href="http://javaee.support/#Servlet" title="Java Servlet 3.1">Servlet</a></li></li></ul></div><div class="large-2 columns contributors"><ul class="inline-list"><li itemscope="" itemtype="http://data-vocabulary.org/Person"><meta itemprop="role" content="author"><meta itemprop="name" content="Arjan Tijms"><meta itemprop="affiliation" content=""><img class="photo" title="Arjan Tijms" src="http://gravatar.com/avatar/d383928ce35a8dab6f4cf8f4e5e269b9?s=25" itemprop="photo"></li></ul></div></div></div><script type="text/javascript">//$(function() { activateGuideMenuControl() })</script></header><div class="row"><div class="large-12 columns"><div id="test"><div class="row"><div class="large-7 columns"><h4>SubjectFromPolicyContextTest</h4></div><div class="large-3 columns"><ul class="inline-list" style="margin-left:0em;"><li style="margin-left: 0.3em"><i class="fi-like" title="All tests pass on glassfish" style="color: green"></i></li><li style="margin-left: 0.3em"><i class="fi-dislike" title="Not all tests pass on tomee" style="color: red"></i></li><li style="margin-left: 0.3em"><i class="fi-dislike" title="Not all tests pass on wildfly" style="color: red"></i></li></ul></div><div class="large-2 columns"><a class="right" href="https://github.com/javaee-samples/javaee7-samples/edit/master/jacc/contexts/src/test/java/org/javaee7/jacc/contexts/SubjectFromPolicyContextTest.java"><i class="fi-page-edit"></i></a></div></div><div class="paragraph">
<p>This test demonstrates both how to obtain the {@link Subject} and then how to indirectly retrieve the roles from
this Subject.
&lt;p&gt;
This will be done by calling a Servlet that retrieves the {@link Subject} of the authenticated user.
Authentication happens via the {@link TestServerAuthModule} when the "doLogin" parameter is present in
the request.
&lt;p&gt;
The Subject (a "bag of principals") typically contains the user name principal that can also be obtained via
{@link HttpServletRequest#getUserPrincipal()} and may contain the roles this user has. But, it has never
been standardized in Java EE which principal (attribute) of the Subject represents the user name and
which ones represent the roles, so every container does it differently. On top of that JACC did not specify
that <strong>the</strong> Subject should be returned and implementations not rarely return a Subject that contains only the
user name principal instead of the real Subject with all principals.
&lt;p&gt;
Via a somewhat obscure workaround via JACC it&#8217;s possible to fetch the roles from the Subject
in a standard way.
See &lt;a href="https://blogs.oracle.com/monzillo/entry/using_jacc_to_determine_a"&gt;Using JACC to determine a caller&#8217;s roles&lt;/a&gt;
&lt;p&gt;</p>
</div><div class="improve">Missing a description for the deployment. Add some javadoc to the @Deployment method. <a class="right button tiny round" href="https://github.com/javaee-samples/javaee7-samples/edit/master/jacc/contexts/src/test/java/org/javaee7/jacc/contexts/SubjectFromPolicyContextTest.java">Show me how! <i class="fi-page-edit"></i></a></div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Deployment(testable = false)
public static WebArchive createDeployment() {
    return defaultArchive().addPackages(true, "org.javaee7.jacc");
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that we are able to obtain a reference to the {@link Subject} from a Servlet.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testCanObtainRequestInServlet() throws IOException, SAXException {

    String response = getFromServerPath("subjectServlet?doLogin");

    assertTrue(response.contains("Obtained subject from context."));
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that we are able to obtain a reference to the {@link Subject} from a Servlet and
use JACC to get the roles the user from its principals.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testCanObtainRolesFromSubjectInServlet() throws IOException, SAXException {

    String response = getFromServerPath("subjectServlet?doLogin");

    // The role that was assigned to the user in TestServerAuthModule
    assertTrue(response.contains("User has role architect"));

    // Servlet 13.3; Every authenticated user should have this role and isUserInRole should return true
    // when tested.
    assertTrue(response.contains("User has role **"));
}</code></pre>
</div>
</div></div><div id="test"><div class="row"><div class="large-7 columns"><h4>RequestFromPolicyContextTest</h4></div><div class="large-3 columns"><ul class="inline-list" style="margin-left:0em;"><li style="margin-left: 0.3em"><i class="fi-like" title="All tests pass on glassfish" style="color: green"></i></li><li style="margin-left: 0.3em"><i class="fi-dislike" title="Not all tests pass on tomee" style="color: red"></i></li><li style="margin-left: 0.3em"><i class="fi-dislike" title="Not all tests pass on wildfly" style="color: red"></i></li></ul></div><div class="large-2 columns"><a class="right" href="https://github.com/javaee-samples/javaee7-samples/edit/master/jacc/contexts/src/test/java/org/javaee7/jacc/contexts/RequestFromPolicyContextTest.java"><i class="fi-page-edit"></i></a></div></div><div class="paragraph">
<p>This tests demonstrates how code can obtain a reference to the {@link HttpServletRequest} from the JACC
context.</p>
</div><div class="improve">Missing a description for the deployment. Add some javadoc to the @Deployment method. <a class="right button tiny round" href="https://github.com/javaee-samples/javaee7-samples/edit/master/jacc/contexts/src/test/java/org/javaee7/jacc/contexts/RequestFromPolicyContextTest.java">Show me how! <i class="fi-page-edit"></i></a></div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Deployment(testable = false)
public static WebArchive createDeployment() {
    return defaultArchive().addPackages(true, "org.javaee7.jacc");
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that we are able to obtain a reference to the {@link HttpServletRequest} from a Servlet.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testCanObtainRequestInServlet() throws IOException, SAXException {

    String response = getFromServerPath("requestServlet");

    assertTrue(response.contains("Obtained request from context."));
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that we are able to obtain a reference to the {@link HttpServletRequest} from an EJB.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testCanObtainRequestInEJB() throws IOException, SAXException {

    String response = getFromServerPath("requestServletEJB");

    assertTrue(response.contains("Obtained request from context."));
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that the {@link HttpServletRequest} reference that we obtained from JACC in a Servlet actually
works by getting a request attribute and request parameter from it.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testDataInServlet() throws IOException, SAXException {

    String response = getFromServerPath("requestServlet?jacc_test=true");

    assertTrue(
        "Request scope attribute not present in request obtained from context in Servlet, but should have been",
        response.contains("Attribute present in request from context.")
    );

    assertTrue(
        "Request parameter not present in request obtained from context in Servlet, but should have been",
        response.contains("Request parameter present in request from context.")
    );
}</code></pre>
</div>
</div><div class="paragraph">
<p>Tests that the {@link HttpServletRequest} reference that we obtained from JACC in an EJB actually
works by getting a request attribute and request parameter from it.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test
public void testDataInEJB() throws IOException, SAXException {

    String response = getFromServerPath("requestServlet?jacc_test=true");

    assertTrue(
        "Request scope attribute not present in request obtained from context in EJB, but should have been",
        response.contains("Attribute present in request from context.")
    );

    assertTrue(
        "Request parameter not present in request obtained from context in EJB, but should have been",
        response.contains("Request parameter present in request from context.")
    );
}</code></pre>
</div>
</div></div><script type="text/javascript">$(function() {
  hljs.initHighlightingOnLoad();
})</script></div></div><div class="row"><div class="large-12 columns"><div class="large-6 columns"><h3>Share the Knowledge</h3>Find this sample useful? <a href="http://twitter.com/home/?status=Just%20read%20the%20%23JavaEE-Sample%20%22Contexts%22%20and%20learned%20something%20new!%20http://javaee.support/sample/jacc-contexts/">Share on <i class="fi-social-twitter"></i></a><p>There's a lot more about JavaEE to cover. If you're ready to learn more, check out the <a href="http://javaee.support/">other available samples</a>.</p></div><div class="large-6 columns"><h3>Help Improve</h3>Find a bug in the sample? Something missing? You can fix it by <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jacc/contexts//src/test/java">editing the source</a>, making the correction and sending a pull request. Or report the problem to the <a href="https://github.com/javaee-samples/javaee7-samples/issues">issue tracker</a></div></div></div><div class="row"><div class="large-12 columns changes"><h4>Recent Changelog</h4><ul><li>Jan 31, 2014: A few jacc related; getting the request and subject from the policy <em>by arjan tijms</em></li></ul></div></div><div id="improve" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to help improve this sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jacc/contexts/">javaee7-samples</a> <i class="fi-social-github"></i>GitHub repository. The first thing you need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="highlight"><code>git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jacc/contexts/</code></pre><p>Do the changes as you see fit and send a pull request!</p><p>Good Luck!</p></hr></div></div><footer style="max-width: 100%"><div class="row"><div class="large-6 columns" style="margin-bottom: .75em; margin-top: .75em"><ul class="unstyled"><li>&#169; Copyright 2013-2014 JavaEE Samples.</li><li><i class="fi-like"></i>&nbsp;Mixed with <a href="http://foundation.zurb.com/">Foundation</a>. Baked by <a href="http://awestruct.org">Awestruct</a>.</li><li><i class="fi-share"></i>&nbsp;Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</li></ul></div></div></footer><script src="http://javaee.support/javascripts/foundation/foundation.js"></script><script src="http://javaee.support/javascripts/foundation/foundation.topbar.js"></script><script src="http://javaee.support/javascripts/foundation/foundation.reveal.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/pojoaque.css"><script type="text/javascript">$(document).foundation()</script><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount','UA-18727998-5']);
_gaq.push(['_trackPageview']);
(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body>
<!DOCTYPE html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>JavaEE Sample::JAXRS::Async Client</title><link rel="stylesheet" href="http://javaee-samples.github.io/stylesheets/foundation-icons.css"><link rel="stylesheet" href="http://javaee-samples.github.io/stylesheets/app.css"><script src="http://javaee-samples.github.io/javascripts/vendor/custom.modernizr.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="author" type="text/plain" href="http://javaee-samples.github.io/humans.txt"><link rel="author" href="https://plus.google.com/101195212405190467512"><link rel="author" href="https://plus.google.com/118222277307713726144"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Async Client"><meta name="twitter:description" content="Invoke a JAX-RS service via an asynchronous client"></head><body class="antialiased"><nav class="top-bar"><ul class="title-area"><li class="name"><h1><a href="http://javaee-samples.github.io/">JavaEE Samples</a></h1></li><li class="toggle-topbar"><a href="#"><i class="fi-home"></i></a></li></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="http://javaee-samples.github.io/contributors">Contributors <i class="fi-torsos-male-female"></i></a></li></li></ul></section></nav><div class="container"><header><div class="row"><div class="large-10 columns"><h2>Async Client</h2></div><div class="large-2 columns"><div class="action right"><a class="button radius round success" data-reveal-id="run">Run <i class="fi-play"></i></a><div id="run" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to run the sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jaxrs/async-client/">javaee7-samples</a> <i class="fi-social-github"></i>GitHub repository. The first thing we need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="highlight"><code>git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jaxrs/async-client/</code></pre>Now we are ready to start testing. You can run all the tests in this sample by executing:<pre class="highlight"><code>mvn test</code></pre>Or you can run individual tests by executing one of the following:<pre class="highlight"><code>mvn test -Dtest=MyResourceTest</code></pre></hr></div></div></div></div><div class="row"><div class="large-10 columns"><h3>Invoke a JAX-RS service via an asynchronous client</h3></div></div><div class="sub"><div class="row"><div class="large-10 columns specifications"><ul class="inline-list"><li>Specifications in use:</li><li><ul class="inline-list"></ul><li><a href="http://javaee-samples.github.io/#JAXRS" title="Java API for RESTful Web Services 2.0">JAXRS</a></li></li></ul></div><div class="large-2 columns contributors"><ul class="inline-list"><li itemscope="" itemtype="http://data-vocabulary.org/Person"><meta itemprop="role" content="author"><meta itemprop="name" content="Arun Gupta"><meta itemprop="affiliation" content="Red Hat Software"><img class="photo" title="Arun Gupta" src="http://gravatar.com/avatar/268f57c236bb50c0f6e12ac38adc9d81?s=25" itemprop="photo"></li><li itemscope="" itemtype="http://data-vocabulary.org/Person"><meta itemprop="role" content="author"><meta itemprop="name" content="Aslak Knutsen"><meta itemprop="affiliation" content="Red Hat, Inc."><img class="photo" title="Aslak Knutsen" src="http://gravatar.com/avatar/3f27861ec08730fd02c91fe4129d2668?s=25" itemprop="photo"></li></ul></div></div></div><script type="text/javascript">//$(function() { activateGuideMenuControl() })</script></header><div class="row"><div class="large-12 columns"><div id="test"><div class="row"><div class="large-7 columns"><h4>MyResourceTest</h4></div><div class="large-3 columns"><ul class="inline-list" style="margin-left:0em;"><li style="margin-left: 0.3em"><i class="fi-like" title="All tests pass on GlassFish 4.0" style="color: green"></i></li><li style="margin-left: 0.3em"><i class="fi-like" title="All tests pass on WildFly 8.0.0.Final" style="color: green"></i></li><li style="margin-left: 0.3em"><i class="fi-like" title="All tests pass on WildFly 8.1.0.Final" style="color: green"></i></li></ul></div><div class="large-2 columns"><a class="right" href="https://github.com/javaee-samples/javaee7-samples/edit/master/jaxrs/async-client/src/test/java/org/javaee7/jaxrs/asyncclient/MyResourceTest.java"><i class="fi-page-edit"></i></a></div></div><div class="paragraph">
<p>In this sample we&#8217;re going to explore how to communicate with a <code>JAX-RS</code>
service via an asynchronous invocation from the client.</p>
</div>
<div class="paragraph">
<p>First step; we need a service to invoke.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a simple <code>GET</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@GET
public String getList() {
    return response[0];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>JAX-RS</code> to expose our service we need to provide an implementation of
the <code>JAX-RS</code> <code>Application</code> class to define our root path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@ApplicationPath("webresources")
public class MyApplication extends Application {

    public MyApplication() {
        super();
    }
}</code></pre>
</div>
</div><div class="paragraph">
<p>Since <code>JAX-RS</code> webservices are, well, web related and require a
web contex, they are required to be deployed within a <code>web archive</code>.
By default, <code>JAX-RS</code> will perform autodiscovery of our services.
That means there is no need to add a <code>web.xml</code> in this scenario.</p>
</div>
<div class="paragraph">
<p>Based on the definition of our <code>@Deployment</code> method, we will be
creating and deploying the following archive structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="file language-file">/WEB-INF/
/WEB-INF/classes/
/WEB-INF/classes/org/
/WEB-INF/classes/org/javaee7/jaxrs/
/WEB-INF/classes/org/javaee7/jaxrs/asyncclient/
/WEB-INF/classes/org/javaee7/jaxrs/asyncclient/MyResource.class
/WEB-INF/classes/org/javaee7/jaxrs/asyncclient/MyApplication.class</code></pre>
</div>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Deployment(testable = false)
public static WebArchive createDeployment() {
   return ShrinkWrap.create(WebArchive.class)
         .addClasses(MyApplication.class, MyResource.class);
}</code></pre>
</div>
</div><div class="paragraph">
<p>Before we can invoke our service we need to setup the client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Before
public void setUpClass() throws MalformedURLException {
    Client client = ClientBuilder.newClient();
    target = client.target(URI.create(new URL(base, "webresources/fruits").toExternalForm()));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;re free to invoke our deployed service by using the <code>JAX-RS</code>
client library.</p>
</div>
<div class="paragraph">
<p>The asynchronous client library comes with multiple option on how
to invoke the methods. First let&#8217;s look at using the <code>Future</code> option
with access to the complete <code>Response</code>.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Test
public void testPollingResponse() throws InterruptedException, ExecutionException {
    Future&lt;Response&gt; r1 = target.request().async().get(); <b class="conum">(1)</b>
    String response = r1.get().readEntity(String.class);  <b class="conum">(2)</b>
    assertEquals("apple", response);                      <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Build an asynchronous request handler for the <code>Response</code> object</p>
</li>
<li>
<p>Read the entity from the body of the <code>Response</code></p>
</li>
<li>
<p>Validate we got the expected value</p>
</li>
</ol>
</div><div class="paragraph">
<p>Another possibility is to use the <code>Future</code> option with access to only the <code>Response</code> body.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Test
public void testPollingString() throws InterruptedException, ExecutionException {
    Future&lt;String&gt; r1 = target.request().async().get(String.class); <b class="conum">(1)</b>
    String response = r1.get();                                     <b class="conum">(2)</b>
    assertEquals("apple", response);                                <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Build an asynchronous request handler for the body of the <code>Response</code></p>
</li>
<li>
<p>Read the entity directly from the <code>Future</code></p>
</li>
<li>
<p>Validate we got the expected value</p>
</li>
</ol>
</div><div class="paragraph">
<p>You can also register a <code>InvocationCallback</code> and get a callback when the <code>Request</code> is done.</p>
</div><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Test
public void testInvocationCallback() throws InterruptedException, ExecutionException {
        target.request().async().get(new InvocationCallback&lt;String&gt;() { <b class="conum">(1)</b>

            @Override
            public void completed(String r) {                           <b class="conum">(2)</b>
                assertEquals("apple", r);
            }

            @Override
            public void failed(Throwable t) {                           <b class="conum">(3)</b>
                fail(t.getMessage());
            }

        });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Build an asynchronous request callback for the body of the <code>Response</code></p>
</li>
<li>
<p>Called when the <code>Request</code> is completed and our entiy parsed</p>
</li>
<li>
<p>Called if the <code>Request</code> failed to complete</p>
</li>
</ol>
</div></div><script type="text/javascript">$(function() {
  hljs.initHighlightingOnLoad();
})</script></div></div><div class="row"><div class="large-12 columns"><div class="large-6 columns"><h3>Share the Knowledge</h3>Find this sample useful? <a href="http://twitter.com/home/?status=Just%20read%20the%20%23JavaEE-Sample%20%22JAXRS::Async%20Client%22%20and%20learned%20something%20new!%20http://javaee-samples.github.io/sample/jaxrs-async-client/">Share on <i class="fi-social-twitter"></i></a><p>There's a lot more about JavaEE to cover. If you're ready to learn more, check out the <a href="http://javaee-samples.github.io/">other available samples</a>.</p></div><div class="large-6 columns"><h3>Help Improve</h3>Find a bug in the sample? Something missing? You can fix it by <a href="https://github.com/javaee-samples/javaee7-samples/edit/master/jaxrs/async-client/src/test/java/org/javaee7/jaxrs/asyncclient/MyResourceTest.java">editing the source</a>, making the correction and sending a pull request. Or report the problem to the <a href="https://github.com/javaee-samples/javaee7-samples/issues">issue tracker</a></div></div></div><div class="row"><div class="large-12 columns changes"><h4>Recent Changelog</h4><ul><li><div>Jan 13, 2014: Fix typo in jax-rs::async-client description <em>by Aslak Knutsen</em></div></li><li><div>Jan 10, 2014: Add description to jax-rs:async-client sample <em>by Aslak Knutsen</em></div></li><li><div>Dec 03, 2013: Change to use client.target(uri) to be compatible with jax-rs 1.0 <em>by Aslak Knutsen</em></div></li><li><div>Nov 12, 2013: Convert jax-rs samples to arquillian: async client <em>by Aslak Knutsen</em></div></li><li><div>Nov 08, 2013: Initializing the client before each test <em>by Arun Gupta</em></div></li><li><div>Nov 07, 2013: Converting servlet into tests <em>by Arun Gupta</em></div></li><li><div>Oct 27, 2013: Removing redundant dependencies <em>by Arun Gupta</em></div></li><li><div>Sep 17, 2013: Removing netbeans configuration file <em>by Arun Gupta</em></div></li><li><div>Aug 27, 2013: Adding copyright, fixing the url to be context root sensitive <em>by Arun Gupta</em></div></li><li><div>Aug 27, 2013: Moving the source code from http://svn.java.net/svn/glassfish~svn/branches/arun/javaee7-samples/samples/ <em>by Arun Gupta</em></div></li></ul></div></div><div id="improve" class="hide reveal-modal" data-reveal=""><a class="close-reveal-modal" href="./">How to help improve this sample <i class="fi-x"></i></a><hr class="clear">The source code for this sample can be found in the <a href="https://github.com/javaee-samples/javaee7-samples/tree/master/jaxrs/async-client/">javaee7-samples</a> <i class="fi-social-github"></i>GitHub repository. The first thing you need to do is to get the source by downloading the repository and then go into the samples folder:<pre class="highlight"><code>git clone git://github.com/javaee-samples/javaee7-samples.git<br/>cd javaee7-samples/jaxrs/async-client/</code></pre><p>Do the changes as you see fit and send a pull request!</p><p>Good Luck!</p></hr></div></div><footer style="max-width: 100%"><div class="row"><div class="large-6 columns" style="margin-bottom: .75em; margin-top: .75em"><ul class="unstyled"><li>&#169; Copyright 2013-2014 JavaEE Samples.</li><li><i class="fi-like"></i>&nbsp;Mixed with <a href="http://foundation.zurb.com/">Foundation</a>. Baked by <a href="http://awestruct.org">Awestruct</a>.</li><li><i class="fi-share"></i>&nbsp;Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</li></ul></div></div></footer><script src="http://javaee-samples.github.io/javascripts/foundation/foundation.js"></script><script src="http://javaee-samples.github.io/javascripts/foundation/foundation.topbar.js"></script><script src="http://javaee-samples.github.io/javascripts/foundation/foundation.reveal.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/pojoaque.css"><script type="text/javascript">$(document).foundation()</script><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount','UA-18727998-5']);
_gaq.push(['_trackPageview']);
(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body>